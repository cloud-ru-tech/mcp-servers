# MCP Yandex Search Server

MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ Yandex Search API –Ω–∞ –±–∞–∑–µ FastMCP —Å SSE –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîç –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Yandex Search API
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, URL –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
- üíæ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü
- üåê SSE (Server-Sent Events) –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- üê≥ Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.13+
- Yandex Cloud API –∫–ª—é—á
- Yandex Cloud Folder ID

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd mcp-yandex-search

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make install

# –ò–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make dev
```

### Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
make docker-build

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make docker-run
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export YANDEX_API_KEY="your-yandex-api-key"
export YANDEX_FOLDER_ID="your-folder-id"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞ Yandex Cloud

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Yandex Cloud Console](https://console.cloud.yandex.ru/)
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
3. –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª—å `search-api.executor`
4. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –ø–∞–ø–∫–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
make run
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π

```bash
make dev-run
```

### Docker –∑–∞–ø—É—Å–∫

```bash
make docker-run
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
- HTTP: `http://localhost:8003`
- SSE: `http://localhost:8003/sse`
- Messages: `http://localhost:8003/messages/`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### `search_web`

–ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ Yandex Search API.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `query` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `page_size` (int, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å 50)
- `page_number` (int, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π): –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–∞—á–∏–Ω–∞—è —Å 0 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "name": "search_web",
  "arguments": {
    "query": "FastMCP tutorial",
    "page_size": 5,
    "page_number": 0
  }
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MCP –∫–ª–∏–µ–Ω—Ç–æ–º

```python
import asyncio
from mcp.client import MCPClient

async def main():
    client = MCPClient("http://localhost:8003")
    
    # –ü–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
    result = await client.call_tool("search_web", {
        "query": "Python MCP server",
        "page_size": 10
    })
    
    print(result)

asyncio.run(main())
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
mcp-yandex-search/
‚îú‚îÄ‚îÄ server.py              # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ pyproject.toml         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker Compose
‚îú‚îÄ‚îÄ Makefile             # –ó–∞–¥–∞—á–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ test/                # –¢–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_yandex_api.py
    ‚îú‚îÄ‚îÄ test_tools.py
    ‚îî‚îÄ‚îÄ test_integration.py
```

### –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make dev

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
make lint

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make format

# –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
make clean
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest test/test_yandex_api.py -v

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest test/ --cov=. --cov-report=html
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **YandexSearchAPI** - –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Yandex Search API
2. **YandexSearchParser** - –ü–∞—Ä—Å–µ—Ä XML –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç API
3. **FastMCP Server** - MCP —Å–µ—Ä–≤–µ—Ä —Å SSE —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º
4. **Starlette App** - Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

```
Client Request ‚Üí SSE Transport ‚Üí MCP Server ‚Üí YandexSearchAPI ‚Üí Yandex Cloud API
                                                     ‚Üì
Client Response ‚Üê SSE Transport ‚Üê MCP Server ‚Üê YandexSearchParser ‚Üê XML Response
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–≥–∏ –≤:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ (stdout)
- –§–∞–π–ª `logs/server.log` (–ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Docker)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
curl -f http://localhost:8003/sse

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Docker
docker-compose ps
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"Missing YANDEX_API_KEY"**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞

2. **"Yandex Search API error: 403"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ä–æ–ª—å `search-api.executor`

3. **"Failed to parse XML response"**
   - API –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π XML
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –û—Ç–ª–∞–¥–∫–∞

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
DEBUG=1 python server.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
HTTPX_LOG_LEVEL=DEBUG python server.py
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. 